% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={HUDM6026 Homework\_04},
  pdfauthor={Seng Lei and Chenguang Pan},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{HUDM6026 Homework\_04}
\author{Seng Lei and Chenguang Pan}
\date{Feb 17, 2023}

\begin{document}
\maketitle

\hypertarget{part-01-homework-03s-solution}{%
\subsection{PART 01: Homework 03's
Solution}\label{part-01-homework-03s-solution}}

Step 1, input the given variance-covariance matrix; Note, since these
ten variables follow the standard normal distribution, the values in
correlation matrix is same to the value in var-cov martix.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}} \FunctionTok{library}\NormalTok{(mvtnorm)}
\SpecialCharTok{\textgreater{}}\NormalTok{ cov }\OtherTok{=} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{),}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\SpecialCharTok{\textgreater{}} \CommentTok{\# randomly generate one row of data to test this matrix}
\ErrorTok{\textgreater{}} \CommentTok{\# X \textless{}{-} rmvnorm(1,sigma = cov) \# looking good}
\end{Highlighting}
\end{Shaded}

Step 2, write a function to generate 500 observations

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ dat\_gen }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, cov)\{}
\SpecialCharTok{+}   \FunctionTok{return}\NormalTok{(}\FunctionTok{rmvnorm}\NormalTok{(n, }\AttributeTok{mean=}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{10}\NormalTok{), }\AttributeTok{sigma=}\NormalTok{cov))\}}
\SpecialCharTok{\textgreater{}}\NormalTok{ s1 }\OtherTok{\textless{}{-}} \FunctionTok{dat\_gen}\NormalTok{(}\DecValTok{500}\NormalTok{, cov)}
\SpecialCharTok{\textgreater{}} \FunctionTok{head}\NormalTok{(s1) }\CommentTok{\# looking good}
\NormalTok{           [,}\DecValTok{1}\NormalTok{]        [,}\DecValTok{2}\NormalTok{]       [,}\DecValTok{3}\NormalTok{]       [,}\DecValTok{4}\NormalTok{]       [,}\DecValTok{5}\NormalTok{]       [,}\DecValTok{6}\NormalTok{]}
\NormalTok{[}\DecValTok{1}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{1.2033983}  \FloatTok{2.16405854}  \FloatTok{1.8925290} \SpecialCharTok{{-}}\FloatTok{0.1347842} \SpecialCharTok{{-}}\FloatTok{0.8800321}  \FloatTok{1.8201396}
\NormalTok{[}\DecValTok{2}\NormalTok{,]  }\FloatTok{0.5122555}  \FloatTok{0.06995376}  \FloatTok{0.5754062} \SpecialCharTok{{-}}\FloatTok{0.2193337} \SpecialCharTok{{-}}\FloatTok{1.6305364} \SpecialCharTok{{-}}\FloatTok{0.0802548}
\NormalTok{[}\DecValTok{3}\NormalTok{,]  }\FloatTok{0.1796472} \SpecialCharTok{{-}}\FloatTok{0.01626371} \SpecialCharTok{{-}}\FloatTok{0.2864921} \SpecialCharTok{{-}}\FloatTok{0.1460917}  \FloatTok{1.2931921} \SpecialCharTok{{-}}\FloatTok{0.3975117}
\NormalTok{[}\DecValTok{4}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.8878763}  \FloatTok{1.28878777}  \FloatTok{0.4147153}  \FloatTok{0.6480119} \SpecialCharTok{{-}}\FloatTok{0.6308978}  \FloatTok{1.3782255}
\NormalTok{[}\DecValTok{5}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.6189909}  \FloatTok{1.18963879}  \FloatTok{1.3302009} \SpecialCharTok{{-}}\FloatTok{1.0194905}  \FloatTok{0.5789616}  \FloatTok{0.9689868}
\NormalTok{[}\DecValTok{6}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.6755019}  \FloatTok{0.74083768}  \FloatTok{0.5248268} \SpecialCharTok{{-}}\FloatTok{1.0265009}  \FloatTok{0.7863574} \SpecialCharTok{{-}}\FloatTok{0.1428945}
\NormalTok{           [,}\DecValTok{7}\NormalTok{]       [,}\DecValTok{8}\NormalTok{]        [,}\DecValTok{9}\NormalTok{]       [,}\DecValTok{10}\NormalTok{]}
\NormalTok{[}\DecValTok{1}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.6463804} \SpecialCharTok{{-}}\FloatTok{0.2958384} \SpecialCharTok{{-}}\FloatTok{0.26469535}  \FloatTok{0.11363994}
\NormalTok{[}\DecValTok{2}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.1766832}  \FloatTok{1.6925166} \SpecialCharTok{{-}}\FloatTok{0.35073475} \SpecialCharTok{{-}}\FloatTok{0.05368432}
\NormalTok{[}\DecValTok{3}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{1.0065125}  \FloatTok{0.5366323} \SpecialCharTok{{-}}\FloatTok{0.09821094}  \FloatTok{0.15239918}
\NormalTok{[}\DecValTok{4}\NormalTok{,]  }\FloatTok{0.4702731} \SpecialCharTok{{-}}\FloatTok{0.5510015}  \FloatTok{0.40660522} \SpecialCharTok{{-}}\FloatTok{1.10826913}
\NormalTok{[}\DecValTok{5}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.5531109}  \FloatTok{2.8420892} \SpecialCharTok{{-}}\FloatTok{0.78926520}  \FloatTok{0.56090351}
\NormalTok{[}\DecValTok{6}\NormalTok{,]  }\FloatTok{0.3264251} \SpecialCharTok{{-}}\FloatTok{0.8211002} \SpecialCharTok{{-}}\FloatTok{0.91033567}  \FloatTok{1.95166596}
\end{Highlighting}
\end{Shaded}

Step 3, dicotormize the 1st, 3rd, 5th, 6th, 8th, and 9th variable within
a for-loop.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}} \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{)) \{}
\SpecialCharTok{+}\NormalTok{   s1[,i] }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(s1[,i] }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(s1[,i]), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\SpecialCharTok{+}\NormalTok{ \}}
\SpecialCharTok{\textgreater{}} \FunctionTok{head}\NormalTok{(s1)}
\NormalTok{     [,}\DecValTok{1}\NormalTok{]        [,}\DecValTok{2}\NormalTok{] [,}\DecValTok{3}\NormalTok{]       [,}\DecValTok{4}\NormalTok{] [,}\DecValTok{5}\NormalTok{] [,}\DecValTok{6}\NormalTok{]       [,}\DecValTok{7}\NormalTok{] [,}\DecValTok{8}\NormalTok{] [,}\DecValTok{9}\NormalTok{]}
\NormalTok{[}\DecValTok{1}\NormalTok{,]    }\DecValTok{0}  \FloatTok{2.16405854}    \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.1347842}    \DecValTok{0}    \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.6463804}    \DecValTok{0}    \DecValTok{0}
\NormalTok{[}\DecValTok{2}\NormalTok{,]    }\DecValTok{1}  \FloatTok{0.06995376}    \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.2193337}    \DecValTok{0}    \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.1766832}    \DecValTok{1}    \DecValTok{0}
\NormalTok{[}\DecValTok{3}\NormalTok{,]    }\DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.01626371}    \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.1460917}    \DecValTok{1}    \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{1.0065125}    \DecValTok{1}    \DecValTok{0}
\NormalTok{[}\DecValTok{4}\NormalTok{,]    }\DecValTok{0}  \FloatTok{1.28878777}    \DecValTok{1}  \FloatTok{0.6480119}    \DecValTok{0}    \DecValTok{1}  \FloatTok{0.4702731}    \DecValTok{0}    \DecValTok{1}
\NormalTok{[}\DecValTok{5}\NormalTok{,]    }\DecValTok{0}  \FloatTok{1.18963879}    \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{1.0194905}    \DecValTok{1}    \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.5531109}    \DecValTok{1}    \DecValTok{0}
\NormalTok{[}\DecValTok{6}\NormalTok{,]    }\DecValTok{0}  \FloatTok{0.74083768}    \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{1.0265009}    \DecValTok{1}    \DecValTok{0}  \FloatTok{0.3264251}    \DecValTok{0}    \DecValTok{0}
\NormalTok{           [,}\DecValTok{10}\NormalTok{]}
\NormalTok{[}\DecValTok{1}\NormalTok{,]  }\FloatTok{0.11363994}
\NormalTok{[}\DecValTok{2}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{0.05368432}
\NormalTok{[}\DecValTok{3}\NormalTok{,]  }\FloatTok{0.15239918}
\NormalTok{[}\DecValTok{4}\NormalTok{,] }\SpecialCharTok{{-}}\FloatTok{1.10826913}
\NormalTok{[}\DecValTok{5}\NormalTok{,]  }\FloatTok{0.56090351}
\NormalTok{[}\DecValTok{6}\NormalTok{,]  }\FloatTok{1.95166596}
\end{Highlighting}
\end{Shaded}

\hypertarget{part-02-homework-03-continued}{%
\subsection{PART 02: Homework 03
Continued}\label{part-02-homework-03-continued}}

\hypertarget{choose-the-propensity-score-models}{%
\subsubsection{2.1 Choose the Propensity Score
Models}\label{choose-the-propensity-score-models}}

For this homework, I choose the scenario B:
\[Pr[A=1|W_i]=(1+e^{-(\beta_0+\beta_1W_1+\beta_2W_2+\beta_3W_3+\beta_4W_4+\beta_5W_5 +\beta_6W_6+\beta_7W_7+\beta_2W_2W_2)})^{-1}\].

\hypertarget{using-binnor-to-generate-observations}{%
\subsubsection{\texorpdfstring{2.2 Using \texttt{BinNor} to Generate
Observations}{2.2 Using BinNor to Generate Observations}}\label{using-binnor-to-generate-observations}}

In the initial stage for data generating, one problem is if we first
generate data based on the correlation matrix and then dichotomize some
of the data according to the means, the final correlation will be
attenuated comparing to the original one. Based on the Prof.Keller's
in-class notes, here I choose the function \texttt{BinNor}.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}} \FunctionTok{library}\NormalTok{(BinNor)}
\SpecialCharTok{\textgreater{}} \CommentTok{\# import the cor matrix}
\ErrorTok{\textgreater{}}\NormalTok{ cmat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.9}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}
\SpecialCharTok{+}                \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{),}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\SpecialCharTok{\textgreater{}} 
\ErrorTok{\textgreater{}} \CommentTok{\# always report warning: All correlations must be in feasible range!}
\ErrorTok{\textgreater{}}\NormalTok{ sigma.star }\OtherTok{\textless{}{-}} \FunctionTok{compute.sigma.star}\NormalTok{(}\AttributeTok{no.bin =} \DecValTok{6}\NormalTok{,}
\SpecialCharTok{+}                                  \AttributeTok{no.nor =} \DecValTok{4}\NormalTok{,}
\SpecialCharTok{+}                                  \AttributeTok{prop.vec.bin =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{),}
\SpecialCharTok{+}                                  \AttributeTok{corr.mat =}\NormalTok{ cmat)}
\SpecialCharTok{\textgreater{}} 
\ErrorTok{\textgreater{}}\NormalTok{ mydata }\OtherTok{\textless{}{-}} \FunctionTok{jointly.generate.binary.normal}\NormalTok{(}\AttributeTok{no.rows =} \DecValTok{500}\NormalTok{,}
\SpecialCharTok{+}                                          \AttributeTok{no.bin =} \DecValTok{6}\NormalTok{,}
\SpecialCharTok{+}                                          \AttributeTok{no.nor =} \DecValTok{4}\NormalTok{,}
\SpecialCharTok{+}                                          \AttributeTok{prop.vec.bin =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.5}\NormalTok{),}
\SpecialCharTok{+}                                          \AttributeTok{mean.vec.nor =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{),}
\SpecialCharTok{+}                                          \AttributeTok{var.nor =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{),}
\SpecialCharTok{+}                                          \AttributeTok{sigma.star =}\NormalTok{ sigma.star}\SpecialCharTok{$}\NormalTok{sigma\_star,}
\SpecialCharTok{+}                                          \AttributeTok{continue.with.warning =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

By setting the chunk's parameter \texttt{eval\ =\ FALSE}, the code chunk
above won't run. But after several tries, I can't figure out how
generate the required data through this \texttt{BinNor}. I temporarily
skipped this and use the attenuated data to continue this script.

\hypertarget{rewrite-the-data-generation-function}{%
\subsubsection{2.3 Rewrite the data generation
function}\label{rewrite-the-data-generation-function}}

Here, I rewrite the data generation function to ensure each running time
will produce a matrix with multivariate data and dichotomous data. But,
one should notice, this dataset's correlation matrix is attenuated!!

rewrite the data generation function for several purposes:\\
- generate data multivariate normal distribution and dichotomous data\\
- compute the propensity scores - get dichotomous exposure variable A\\
- get the outcome Y

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ dat\_gen }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, cov)\{ }\CommentTok{\# n is the number of observations}
\SpecialCharTok{+}   \CommentTok{\# generate data from multinormal distribution}
\SpecialCharTok{+}\NormalTok{   data\_01 }\OtherTok{\textless{}{-}} \FunctionTok{rmvnorm}\NormalTok{(n, }\AttributeTok{mean=}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{10}\NormalTok{), }\AttributeTok{sigma=}\NormalTok{cov)}
\SpecialCharTok{+}   \CommentTok{\# dichotomize the columns}
\SpecialCharTok{+}   \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{)) \{data\_01[,i] }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(data\_01[,i] }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(data\_01[,i]), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)\}}
\SpecialCharTok{+}   
\SpecialCharTok{+}   \CommentTok{\# compute propensity score }
\SpecialCharTok{+}\NormalTok{   linear\_part }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{0} \SpecialCharTok{+} \FloatTok{0.8} \SpecialCharTok{*}\NormalTok{ data\_01[,}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}} \FloatTok{0.25}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{2}\NormalTok{]}\SpecialCharTok{+} \FloatTok{0.6}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{3}\NormalTok{]}
\SpecialCharTok{+}                    \SpecialCharTok{{-}}\FloatTok{0.4}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{4}\NormalTok{] }\SpecialCharTok{{-}} \FloatTok{0.8}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{5}\NormalTok{] }\SpecialCharTok{{-}} \FloatTok{0.5}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{6}\NormalTok{]}
\SpecialCharTok{+}                    \SpecialCharTok{+}\FloatTok{0.7}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{7}\NormalTok{] }\SpecialCharTok{{-}} \FloatTok{0.25}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{2}\NormalTok{]}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{2}\NormalTok{])}\SpecialCharTok{/}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\SpecialCharTok{+}\NormalTok{   ps }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(linear\_part, }\ControlFlowTok{function}\NormalTok{(x)\{(}\DecValTok{1} \SpecialCharTok{+} \FunctionTok{exp}\NormalTok{(x))}\SpecialCharTok{\^{}}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)\})}
\SpecialCharTok{+}   \CommentTok{\# add the propensity score vector to the matrix as 11th columns}
\SpecialCharTok{+}\NormalTok{   data\_01 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(data\_01, ps)}
\SpecialCharTok{+}   
\SpecialCharTok{+}   \CommentTok{\# compute the dichotomous exposure}
\SpecialCharTok{+}\NormalTok{   A\_expo }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(n)}
\SpecialCharTok{+}\NormalTok{   A\_expo }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(A\_expo }\SpecialCharTok{\textless{}}\NormalTok{ ps, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\SpecialCharTok{+}   \CommentTok{\# add the exposure to the matrix as 12th columns}
\SpecialCharTok{+}\NormalTok{   data\_01 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(data\_01, A\_expo)}
\SpecialCharTok{+}   
\SpecialCharTok{+}   \CommentTok{\# calculate the outcome Y}
\SpecialCharTok{+}\NormalTok{   Y\_out }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(n)}
\SpecialCharTok{+}\NormalTok{   outcome\_ }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1}\SpecialCharTok{+} \FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{3.85+0.3}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{1}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.36}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{2}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.73}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{3}\NormalTok{]}
\SpecialCharTok{+}                         \SpecialCharTok{{-}}\FloatTok{0.2}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{4}\NormalTok{]}\SpecialCharTok{+}\FloatTok{0.71}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{8}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.19}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{9}\NormalTok{]}
\SpecialCharTok{+}                         \SpecialCharTok{+}\FloatTok{0.26}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{10}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.4}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{12}\NormalTok{])))}\SpecialCharTok{\^{}}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\SpecialCharTok{+}\NormalTok{   Y\_out }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(Y\_out }\SpecialCharTok{\textless{}}\NormalTok{ outcome\_,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)}
\SpecialCharTok{+}   \CommentTok{\# add the exposure to the matrix as 12th columns}
\SpecialCharTok{+}\NormalTok{   data\_01 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(data\_01, Y\_out)}
\SpecialCharTok{+}   
\SpecialCharTok{+}   \CommentTok{\# also create a column to load the Lee\textquotesingle{}s version of outcome, which is continuous}
\SpecialCharTok{+}\NormalTok{   Y\_out\_lee }\OtherTok{\textless{}{-}} \FloatTok{3.85} \SpecialCharTok{+} \FloatTok{0.3}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{1}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.36}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{2}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.73}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{3}\NormalTok{]}
\SpecialCharTok{+}                         \SpecialCharTok{{-}}\FloatTok{0.2}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{4}\NormalTok{]}\SpecialCharTok{+}\FloatTok{0.71}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{8}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.19}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{9}\NormalTok{]}
\SpecialCharTok{+}                         \SpecialCharTok{+}\FloatTok{0.26}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{10}\NormalTok{]}\SpecialCharTok{{-}}\FloatTok{0.4}\SpecialCharTok{*}\NormalTok{data\_01[,}\DecValTok{12}\NormalTok{]}
\SpecialCharTok{+}   \CommentTok{\# note: the error term is intentionally ignored here}
\SpecialCharTok{+}\NormalTok{   data\_01 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(data\_01, Y\_out\_lee)}
\SpecialCharTok{+}   \FunctionTok{return}\NormalTok{(data\_01)}
\SpecialCharTok{+}\NormalTok{ \}}
\SpecialCharTok{\textgreater{}} 
\ErrorTok{\textgreater{}} \CommentTok{\# randomly generate a dataset to see the structure}
\ErrorTok{\textgreater{}}\NormalTok{ data\_test }\OtherTok{\textless{}{-}} \FunctionTok{dat\_gen}\NormalTok{(}\DecValTok{500}\NormalTok{, cov)}
\SpecialCharTok{\textgreater{}} \FunctionTok{round}\NormalTok{(}\FunctionTok{head}\NormalTok{(data\_test),}\DecValTok{2}\NormalTok{)}
\NormalTok{                                           ps A\_expo Y\_out Y\_out\_lee}
\NormalTok{[}\DecValTok{1}\NormalTok{,] }\DecValTok{0}  \FloatTok{0.01} \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.06} \DecValTok{1} \DecValTok{1}  \FloatTok{0.12} \DecValTok{1} \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.73} \FloatTok{0.23}      \DecValTok{1}     \DecValTok{1}      \FloatTok{3.85}
\NormalTok{[}\DecValTok{2}\NormalTok{,] }\DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.68} \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.59} \DecValTok{0} \DecValTok{0}  \FloatTok{0.15} \DecValTok{1} \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.34} \FloatTok{0.73}      \DecValTok{1}     \DecValTok{0}      \FloatTok{3.36}
\NormalTok{[}\DecValTok{3}\NormalTok{,] }\DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.52} \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.25} \DecValTok{0} \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{1.23} \DecValTok{0} \DecValTok{1}  \FloatTok{0.33} \FloatTok{0.33}      \DecValTok{0}     \DecValTok{0}      \FloatTok{4.04}
\NormalTok{[}\DecValTok{4}\NormalTok{,] }\DecValTok{0}  \FloatTok{0.21} \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{1.40} \DecValTok{0} \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.42} \DecValTok{0} \DecValTok{0}  \FloatTok{2.20} \FloatTok{0.57}      \DecValTok{0}     \DecValTok{0}      \FloatTok{3.04}
\NormalTok{[}\DecValTok{5}\NormalTok{,] }\DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.91} \DecValTok{1}  \FloatTok{0.55} \DecValTok{1} \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.07} \DecValTok{0} \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.05} \FloatTok{0.46}      \DecValTok{1}     \DecValTok{0}      \FloatTok{3.75}
\NormalTok{[}\DecValTok{6}\NormalTok{,] }\DecValTok{0} \SpecialCharTok{{-}}\FloatTok{1.15} \DecValTok{1} \SpecialCharTok{{-}}\FloatTok{0.07} \DecValTok{0} \DecValTok{0}  \FloatTok{0.03} \DecValTok{1} \DecValTok{0} \SpecialCharTok{{-}}\FloatTok{0.35} \FloatTok{0.65}      \DecValTok{1}     \DecValTok{0}      \FloatTok{3.53}
\end{Highlighting}
\end{Shaded}

The dataset looks good.

\hypertarget{replicate-the-function}{%
\subsubsection{2.4 Replicate the
function}\label{replicate-the-function}}

Next, I replicate the function for 1000 times.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ R }\OtherTok{\textless{}{-}} \DecValTok{1000}
\SpecialCharTok{\textgreater{}}\NormalTok{ obs }\OtherTok{\textless{}{-}} \DecValTok{500}
\SpecialCharTok{\textgreater{}} \CommentTok{\# data\_list is a list, each entry is a data matrix with 500 obs}
\ErrorTok{\textgreater{}}\NormalTok{ data\_list }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\AttributeTok{n =}\NormalTok{ R,}
\SpecialCharTok{+}                        \AttributeTok{expr =} \FunctionTok{dat\_gen}\NormalTok{(obs,}\AttributeTok{cov =}\NormalTok{ cov),}
\SpecialCharTok{+}                        \AttributeTok{simplify =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{write-a-function-to-estimate-the-ate}{%
\subsubsection{2.5 Write a Function to estimate the
ATE}\label{write-a-function-to-estimate-the-ate}}

The first function is the naive function.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ get\_ate }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data\_mat)\{}
\SpecialCharTok{+}   \CommentTok{\# transform the matrix into dataframe}
\SpecialCharTok{+}\NormalTok{   df\_ }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(data\_mat)}
\SpecialCharTok{+}\NormalTok{   ate }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(df\_[df\_}\SpecialCharTok{$}\NormalTok{A\_expo }\SpecialCharTok{==} \DecValTok{1}\NormalTok{,}\DecValTok{14}\NormalTok{])}\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(df\_[df\_}\SpecialCharTok{$}\NormalTok{A\_expo }\SpecialCharTok{==}\DecValTok{0}\NormalTok{,}\DecValTok{14}\NormalTok{])}
\SpecialCharTok{+}   \FunctionTok{return}\NormalTok{(ate)}
\SpecialCharTok{+}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

This function runs well. Then put it into the dataframe list.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ ate\_list }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data\_list, get\_ate)}
\SpecialCharTok{\textgreater{}}\NormalTok{ ate\_average }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(ate\_list)}
\SpecialCharTok{\textgreater{}}\NormalTok{ ate\_average}
\NormalTok{[}\DecValTok{1}\NormalTok{] }\FloatTok{0.07248186}
\end{Highlighting}
\end{Shaded}

Based on Lee's continuous outcomes, the 1000 simulated data show that
the average treatment effect is 0.0724819.

Next, we use the regression method to get the ate.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ get\_ate\_2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data\_mat)\{}
\SpecialCharTok{+}   \CommentTok{\# transform the matrix into dataframe}
\SpecialCharTok{+}\NormalTok{   df\_ }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(data\_mat)}
\SpecialCharTok{+}\NormalTok{   model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(df\_[,}\DecValTok{14}\NormalTok{] }\SpecialCharTok{\textasciitilde{}}\NormalTok{ df\_[,}\DecValTok{1}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{2}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{3}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{4}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{5}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{6}\NormalTok{]}\SpecialCharTok{+}
\SpecialCharTok{+}\NormalTok{                 df\_[,}\DecValTok{7}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{8}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{9}\NormalTok{]}\SpecialCharTok{+}\NormalTok{df\_[,}\DecValTok{10}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ df\_[,}\DecValTok{12}\NormalTok{])}
\SpecialCharTok{+}   \FunctionTok{return}\NormalTok{(model}\SpecialCharTok{$}\NormalTok{coefficients[}\DecValTok{12}\NormalTok{])}
\SpecialCharTok{+}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

This function runs well. Then put it into the dataframe list.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}}\NormalTok{ ate\_list }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data\_list, get\_ate\_2)}
\SpecialCharTok{\textgreater{}}\NormalTok{ ate\_average }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(ate\_list)}
\SpecialCharTok{\textgreater{}}\NormalTok{ ate\_average}
\NormalTok{[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\FloatTok{4.449186e{-}18}
\end{Highlighting}
\end{Shaded}

This unbiased estimate of average treatment effect is
\ensuremath{-4.4491857\times 10^{-18}}. This result is very close to 0,
which means the treatment effect is almost none.

\hypertarget{discussion}{%
\subsubsection{2.6 Discussion}\label{discussion}}

\begin{enumerate}
\def\labelenumi{(\alph{enumi})}
\item
  The biggest challenge is how to generate the unattenuated data through
  \texttt{BinNorm}. There is no enough information on the internet for
  reference. This homework actually base on the attenuated data.
\item
  Comparing to the unbiased estimation, the biased (naive) estimation is
  unreliable and misleading. For the result from the unbiased estimation
  shows there is no treatment effect, but the alternative one say yes.
\end{enumerate}

\end{document}
